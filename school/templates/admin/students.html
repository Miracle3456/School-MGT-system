{% extends 'base.html' %}
{% block title %}Manage Students{% endblock %}
{% block content %}
  <h2>Students</h2>
  <p class="muted">List of students in the system.</p>

  <table style="margin-top:12px">
    <thead>
      <tr><th>Photo</th><th>Admission</th><th>Name</th><th>Class</th><th>Guardian</th></tr>
    </thead>
    <tbody>
      {% for s in students %}
        <tr>
          <td>
            {% if s.photo %}
              <img src="{{ s.photo.url }}" alt="{{ s.user.get_full_name }}" class="thumb" data-full="{{ s.photo.url }}" style="width:42px;height:42px;border-radius:6px;object-fit:cover;cursor:pointer;border:1px solid #e5e7eb" />
            {% else %}
              <div style="width:42px;height:42px;border-radius:6px;background:#f3f4f6;display:flex;align-items:center;justify-content:center;font-size:12px;color:#6b7280">N/A</div>
            {% endif %}
          </td>
          <td>{{ s.admission_number }}</td>
          <td>
            <a href="{% url 'admin_view_student' s.id %}" class="btn btn-sm btn-outline-primary" style="margin-right:4px">View</a>
            {{ s.user.get_full_name }}
          </td>
          <td>{% if s.student_class %}{{ s.student_class.name }}{% else %}-{% endif %}</td>
          <td>{{ s.guardian_name }}</td>
        </tr>
      {% empty %}
        <tr><td colspan="5" class="muted">No students yet.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <h3 style="margin-top:16px">Add student</h3>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="hidden" name="action" value="add" />
    <div class="row">
      <div class="col">
        <label>Username</label>
        <input name="username" required />
      </div>
      <div class="col">
        <label>Email</label>
        <input name="email" type="email" />
      </div>
    </div>
    <div class="row">
      <div class="col">
        <label>First name</label>
        <input name="first_name" />
      </div>
      <div class="col">
        <label>Last name</label>
        <input name="last_name" />
      </div>
    </div>
    <div class="row">
      <div class="col">
        <label>Password</label>
        <input name="password" type="password" required />
      </div>
      <div class="col">
        <label>Admission number</label>
        <div style="padding:10px;background:#f3f4f6;border-radius:8px;color:#6b7280;font-size:13px">Auto-generated (ST####)</div>
      </div>
    </div>
    <div class="row">
      <div class="col">
        <label>Photo</label>
        <input name="photo" type="file" accept="image/*" />
      </div>
    </div>
    <div class="row">
      <div class="col">
        <label>Class</label>
        <select name="class_id">
          <option value="">-- select --</option>
          {% for c in classes %}
            <option value="{{ c.id }}">{{ c.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col">
        <label>Date of birth</label>
        <input name="date_of_birth" type="date" />
      </div>
    </div>
    <div class="row">
      <div class="col">
        <label>Guardian name</label>
        <input name="guardian_name" />
      </div>
      <div class="col">
        <label>Guardian phone</label>
        <input name="guardian_phone" />
      </div>
    </div>
    <div style="margin-top:12px"><button class="btn" type="submit">Add student</button></div>
  </form>

  <!-- Image modal -->
  <div id="imgModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.75);z-index:1000;align-items:center;justify-content:center;padding:40px">
    <div style="position:relative;max-width:480px;width:100%">
      <button onclick="closeImgModal()" style="position:absolute;top:-32px;right:-32px;background:#111;color:#fff;border:none;border-radius:50%;width:32px;height:32px;cursor:pointer">&times;</button>
      <img id="modalImg" src="" alt="Preview" style="width:100%;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,0.3);object-fit:cover" />
    </div>
  </div>
  <script>
    function closeImgModal(){document.getElementById('imgModal').style.display='none';}
    document.addEventListener('click',function(e){
      if(e.target.classList.contains('thumb')){
        var full=e.target.getAttribute('data-full');
        var m=document.getElementById('imgModal');
        document.getElementById('modalImg').src=full; m.style.display='flex';
      }
      if(e.target.id==='imgModal'){closeImgModal();}
    });
  </script>

{% endblock %}
