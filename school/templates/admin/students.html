{% extends 'base_dashboard.html' %}
{% block title %}Manage Students{% endblock %}
{% block content %}
  <div class="content-header">
    <div>
      <h1 class="content-title">Students</h1>
      <p class="content-subtitle">Manage student records and information</p>
    </div>
    <button class="btn btn-primary" onclick="document.getElementById('addStudentForm').scrollIntoView({behavior:'smooth'})">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 4v16m8-8H4"/></svg>
      Add Student
    </button>
  </div>

  <div class="table-container">
    <div class="table-header">
      <h3>All Students ({{ students.count }})</h3>
      <div class="table-filters">
        <button class="filter-btn">All Classes</button>
        <button class="filter-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/></svg>
        </button>
      </div>
    </div>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>STUDENT</th>
          <th>GENDER</th>
          <th>AGE</th>
          <th>CLASS</th>
          <th>GUARDIAN</th>
          <th>ACTIONS</th>
        </tr>
      </thead>
      <tbody>
        {% for s in students %}
          <tr>
            <td>{{ s.admission_number }}</td>
            <td>
              <div style="display:flex;align-items:center;gap:12px">
                {% if s.photo %}
                  <img src="{{ s.photo.url }}" alt="{{ s.user.get_full_name }}" class="table-avatar" />
                {% else %}
                  <div class="table-avatar" style="background:#e0e7ff;color:#6366f1;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:12px">{{ s.user.first_name|slice:":1" }}{{ s.user.last_name|slice:":1" }}</div>
                {% endif %}
                <div>
                  <div style="font-weight:600;color:var(--text)">{{ s.user.get_full_name }}</div>
                  <div style="font-size:12px;color:var(--muted)">{{ s.user.email|default:"-" }}</div>
                </div>
              </div>
            </td>
            <td>-</td>
            <td>-</td>
            <td>{% if s.student_class %}<span style="padding:4px 8px;background:#f0fdf4;color:#15803d;border-radius:6px;font-size:12px;font-weight:600">{{ s.student_class.name }}</span>{% else %}-{% endif %}</td>
            <td>{{ s.guardian_name }}</td>
            <td>
              <div class="table-actions">
                <a href="{% url 'admin_view_student' s.id %}" class="table-icon-btn" title="View details">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                </a>
                <button class="table-icon-btn" title="Edit">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                </button>
                <button class="table-icon-btn" title="More options">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>
                </button>
              </div>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="7" style="text-align:center;padding:32px;color:var(--muted)">No students yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="table-pagination">
      <div class="pagination-info">Showing 1 to {{ students.count }} of {{ students.count }} entries</div>
      <div class="pagination-btns">
        <button disabled>Previous</button>
        <button style="background:var(--accent);color:#fff;border-color:var(--accent)">1</button>
        <button disabled>Next</button>
      </div>
    </div>
  </div>

  <div class="card" id="addStudentForm" style="margin-top:32px">
    <h3 style="margin-bottom:16px;font-size:18px;font-weight:600">Add New Student</h3>
    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="hidden" name="action" value="add" />
      <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:16px">
        <div>
          <label>Username</label>
          <input name="username" required />
        </div>
        <div>
          <label>Email</label>
          <input name="email" type="email" />
        </div>
        <div>
          <label>First name</label>
          <input name="first_name" required />
        </div>
        <div>
          <label>Last name</label>
          <input name="last_name" required />
        </div>
        <div>
          <label>Password</label>
          <input name="password" type="password" required />
        </div>
        <div>
          <label>Admission number</label>
          <div style="padding:10px;background:#f3f4f6;border-radius:8px;color:var(--muted);font-size:13px">Auto-generated (ST####)</div>
        </div>
        <div>
          <label>Class</label>
          <select name="class_id">
            <option value="">-- select --</option>
            {% for c in classes %}
              <option value="{{ c.id }}">{{ c.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label>Date of birth</label>
          <input name="date_of_birth" type="date" />
        </div>
        <div>
          <label>Guardian name</label>
          <input name="guardian_name" />
        </div>
        <div>
          <label>Guardian phone</label>
          <input name="guardian_phone" />
        </div>
        <div style="grid-column:1/-1">
          <label>Photo</label>
          <input name="photo" type="file" accept="image/*" />
        </div>
      </div>
      <div style="margin-top:20px">
        <button class="btn btn-primary" type="submit">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 4v16m8-8H4"/></svg>
          Add Student
        </button>
      </div>
    </form>
  </div>

  <!-- Image modal -->
  <div id="imgModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.75);z-index:1000;align-items:center;justify-content:center;padding:40px">
    <div style="position:relative;max-width:480px;width:100%">
      <button onclick="closeImgModal()" style="position:absolute;top:-32px;right:-32px;background:#111;color:#fff;border:none;border-radius:50%;width:32px;height:32px;cursor:pointer">&times;</button>
      <img id="modalImg" src="" alt="Preview" style="width:100%;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,0.3);object-fit:cover" />
    </div>
  </div>
  <script>
    function closeImgModal(){document.getElementById('imgModal').style.display='none';}
    document.addEventListener('click',function(e){
      if(e.target.classList.contains('thumb')){
        var full=e.target.getAttribute('data-full');
        var m=document.getElementById('imgModal');
        document.getElementById('modalImg').src=full; m.style.display='flex';
      }
      if(e.target.id==='imgModal'){closeImgModal();}
    });
  </script>

{% endblock %}
