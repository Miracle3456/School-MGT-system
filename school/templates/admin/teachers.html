{% extends 'base_dashboard.html' %}
{% block title %}Manage Teachers{% endblock %}
{% block content %}
  <div class="content-header">
    <div>
      <h1 class="content-title">Teachers</h1>
      <p class="content-subtitle">Manage teacher records and class assignments</p>
    </div>
    <button class="btn btn-primary" onclick="document.getElementById('addTeacherForm').scrollIntoView({behavior:'smooth'})">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 4v16m8-8H4"/></svg>
      Add Teacher
    </button>
  </div>

  <div class="table-container">
    <div class="table-header">
      <h3>All Teachers ({{ teachers.count }})</h3>
      <div class="table-filters" style="display:flex;gap:8px;align-items:center">
        <form method="get" id="teacherFilterForm" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <select name="subject_id" onchange="this.form.submit()" style="padding:6px 10px;border:1px solid var(--border);border-radius:8px">
            <option value="">All Subjects</option>
            {% for s in subjects %}
              <option value="{{ s.id }}" {% if selected_subject_id|stringformat:'s' == s.id|stringformat:'s' %}selected{% endif %}>{{ s.name }}</option>
            {% endfor %}
          </select>
          <select name="class_id" onchange="this.form.submit()" style="padding:6px 10px;border:1px solid var(--border);border-radius:8px">
            <option value="">All Classes</option>
            {% for c in classes %}
              <option value="{{ c.id }}" {% if selected_class_id|stringformat:'s' == c.id|stringformat:'s' %}selected{% endif %}>{{ c.name }}</option>
            {% endfor %}
          </select>
          {% if selected_subject_id or selected_class_id %}
            <a href="{% url 'manage_teachers' %}" class="filter-btn" title="Clear filters" style="text-decoration:none;display:inline-flex;align-items:center;gap:6px">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
              Clear
            </a>
          {% endif %}
        </form>
      </div>
    </div>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>TEACHER</th>
          <th>SUBJECTS</th>
          <th>CLASSES</th>
          <th>ACTIONS</th>
        </tr>
      </thead>
      <tbody>
        {% for t in teachers %}
          <tr>
            <td>{{ t.employee_id }}</td>
            <td>
              <div style="display:flex;align-items:center;gap:12px">
                {% if t.photo %}
                  <img src="{{ t.photo.url }}" alt="{{ t.user.get_full_name }}" class="table-avatar" />
                {% else %}
                  <div class="table-avatar" style="background:#fef3c7;color:#d97706;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:12px">{{ t.user.first_name|slice:":1" }}{{ t.user.last_name|slice:":1" }}</div>
                {% endif %}
                <div>
                  <div style="font-weight:600;color:var(--text)">{{ t.user.get_full_name }}</div>
                  <div style="font-size:12px;color:var(--muted)">{{ t.user.email|default:"-" }}</div>
                </div>
              </div>
            </td>
            <td>
              <div style="display:flex;gap:4px;flex-wrap:wrap">
                {% for s in t.subjects.all %}
                  <span style="padding:4px 8px;background:#ede9fe;color:#7c3aed;border-radius:6px;font-size:12px;font-weight:600">{{ s.name }}</span>
                {% empty %}
                  <span style="color:var(--muted)">-</span>
                {% endfor %}
              </div>
            </td>
            <td>
              <div style="display:flex;gap:4px;flex-wrap:wrap">
                {% for c in t.classes.all %}
                  <span style="padding:4px 8px;background:#f0fdf4;color:#15803d;border-radius:6px;font-size:12px;font-weight:600">{{ c.name }}</span>
                {% empty %}
                  <span style="color:var(--muted)">-</span>
                {% endfor %}
              </div>
            </td>
            <td>
              <div class="table-actions">
                <a href="{% url 'admin_view_teacher' t.id %}" class="table-icon-btn" title="View details" aria-label="View profile">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                </a>
                {% if t.user.email %}
                <a href="mailto:{{ t.user.email }}" class="table-icon-btn" title="Email {{ t.user.get_full_name }}" aria-label="Email">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16v16H4z"/><path d="M22 6l-10 7L2 6"/></svg>
                </a>
                {% else %}
                <span class="table-icon-btn" title="No email available" aria-label="No email" style="opacity:.5;cursor:not-allowed">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16v16H4z"/><path d="M22 6l-10 7L2 6"/></svg>
                </span>
                {% endif %}
                <a href="{% url 'admin_view_teacher' t.id %}#assignments" class="table-icon-btn" title="View assignments" aria-label="Assignments">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>
                </a>
              </div>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="5" style="text-align:center;padding:32px;color:var(--muted)">No teachers yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="table-pagination">
      <div class="pagination-info">Showing 1 to {{ teachers.count }} of {{ teachers.count }} entries</div>
      <div class="pagination-btns">
        <button disabled>Previous</button>
        <button style="background:var(--accent);color:#fff;border-color:var(--accent)">1</button>
        <button disabled>Next</button>
      </div>
    </div>
  </div>

  <div class="card" id="addTeacherForm" style="margin-top:32px">
    <h3 style="margin-bottom:16px;font-size:18px;font-weight:600">Add New Teacher</h3>
    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="hidden" name="action" value="add" />
      <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:16px">
        <div>
          <label>Username</label>
          <input name="username" required />
        </div>
        <div>
          <label>Email</label>
          <input name="email" type="email" />
        </div>
        <div>
          <label>First name</label>
          <input name="first_name" required />
        </div>
        <div>
          <label>Last name</label>
          <input name="last_name" required />
        </div>
        <div>
          <label>Password</label>
          <input name="password" type="password" required />
        </div>
        <div>
          <label>Employee ID</label>
          <div style="padding:10px;background:#f3f4f6;border-radius:8px;color:var(--muted);font-size:13px">Auto-generated (TC####)</div>
        </div>
        <div>
          <label>Subjects</label>
          <select name="subjects" multiple style="min-height:80px">
            {% for s in subjects %}
              <option value="{{ s.id }}">{{ s.name }}</option>
            {% endfor %}
          </select>
          <small style="color:var(--muted);font-size:12px;margin-top:4px;display:block">Hold Ctrl to select multiple</small>
        </div>
        <div>
          <label>Classes</label>
          <select name="classes" multiple style="min-height:80px">
            {% for c in classes %}
              <option value="{{ c.id }}">{{ c.name }}</option>
            {% endfor %}
          </select>
          <small style="color:var(--muted);font-size:12px;margin-top:4px;display:block">Hold Ctrl to select multiple</small>
        </div>
        <div style="grid-column:1/-1">
          <label>Photo</label>
          <input name="photo" type="file" accept="image/*" />
        </div>
      </div>
      <div style="margin-top:20px">
        <button class="btn btn-primary" type="submit">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 4v16m8-8H4"/></svg>
          Add Teacher
        </button>
      </div>
    </form>
  </div>

{% endblock %}
